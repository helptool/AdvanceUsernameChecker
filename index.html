<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AvgecFinder — Username Checker</title>
<style>
  body { font-family: 'Poppins', sans-serif; background:#121212; color:#fff; text-align:center; padding:30px; }
  h1 { color:#ffcc00; }
  .controls { background:#1b1b1b; padding:20px; border-radius:12px; max-width:500px; margin:auto; }
  input, select, button { padding:8px; margin:5px; border-radius:6px; border:none; font-size:1rem; text-align:center; }
  input { width:40px; text-transform:lowercase; }
  button { cursor:pointer; font-weight:600; background:#ffcc00; color:#000; transition:0.2s; }
  button:hover { background:#ffe066; }
  .progress-container { width:100%; background:#444; border-radius:10px; margin:10px 0; height:16px; overflow:hidden; }
  .progress-bar { height:100%; width:0%; background:#00e676; border-radius:10px; transition:width 0.1s ease; }
  .results { margin-top:15px; background:#111; border-radius:10px; padding:15px; max-height:300px; overflow-y:auto; }
  .username { margin:5px; background:#333; padding:5px 8px; border-radius:5px; cursor:pointer; display:inline-block; }
  .username:hover { background:#00e676; color:#000; }
  #counter { margin-top:10px; color:#00e676; font-weight:600; }
</style>
</head>
<body>

<h1>AvgecFinder</h1>
<p>Smart Instagram Username Availability Checker</p>

<div class="controls">
  <label>Select Username Length:</label>
  <select id="length" onchange="generateBoxes()">
    <option value="">Select</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
  </select>

  <div id="charBoxes" style="margin-top:10px;"></div>

  <button onclick="startChecking()">Start</button>
  <button onclick="stopChecking()">Stop</button>

  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  <p id="progressText">Progress: 0%</p>
  <p id="counter">Available Usernames: 0</p>
</div>

<div class="results" id="results"></div>

<script>
const letters = "abcdefghijklmnopqrstuvwxyz";
const numbers = "0123456789";
const specials = "._";
let stopFlag = false;
let batchSize = 50; // number of usernames sent to Worker per batch

function generateBoxes(){
  const len = parseInt(document.getElementById('length').value);
  const boxContainer = document.getElementById('charBoxes');
  boxContainer.innerHTML = '';
  for(let i=0;i<len;i++){
    const input = document.createElement('input');
    input.type='text';
    input.maxLength=1;
    input.placeholder='_';
    input.id='char'+i;
    boxContainer.appendChild(input);
  }
}

function stopChecking(){
  stopFlag=true;
  alert("⛔ Checking stopped by user.");
}

// Helper function to generate combinations recursively with fixed letters
function* generateCombinations(len, fixed){
  const chars = letters + numbers + specials;
  function* helper(index, prefix){
    if(stopFlag) return;
    if(index===len){
      yield prefix;
      return;
    }
    if(fixed[index]){
      yield* helper(index+1, prefix+fixed[index].toLowerCase());
    } else {
      for(let c of chars){
        yield* helper(index+1, prefix+c);
      }
    }
  }
  yield* helper(0,'');
}

// Send batch to Cloudflare Worker
async function checkBatch(workerURL, usernames){
  try{
    const res = await fetch(workerURL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({usernames})
    });
    return await res.json();
  }catch(e){
    console.error(e);
    return {};
  }
}

async function startChecking(){
  stopFlag=false;
  const len = parseInt(document.getElementById('length').value);
  if(!len) return alert("Please select username length first!");
  
  let fixed = [];
  for(let i=0;i<len;i++){
    fixed.push(document.getElementById('char'+i)?.value || '');
  }

  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML='';
  const progressBar = document.getElementById('progressBar');
  const progressText = document.getElementById('progressText');
  const counter = document.getElementById('counter');

  let totalChecked=0;
  let availableCount=0;

  const workerURL = "https://avgecfinder-worker.aryamangupta089.workers.dev";
  const gen = generateCombinations(len, fixed);
  let batch=[];
  let totalCombos=Math.pow((letters+numbers+specials).length,len); // approximate

  for(let username of gen){
    if(stopFlag) break;
    if(username.startsWith('.')||username.endsWith('.')) continue; // skip invalid
    batch.push(username);
    if(batch.length>=batchSize){
      const res = await checkBatch(workerURL,batch);
      for(let key in res){
        totalChecked++;
        if(res[key]){
          availableCount++;
          const div=document.createElement('div');
          div.textContent=key;
          div.className='username';
          div.onclick=()=>navigator.clipboard.writeText(key);
          resultsDiv.appendChild(div);
        }
      }
      batch=[];
      // Update progress
      const progress=Math.min((totalChecked/totalCombos)*100,100);
      progressBar.style.width=`${progress}%`;
      progressText.innerText=`Progress: ${progress.toFixed(1)}% | Checked: ${totalChecked}`;
      counter.innerText=`Available Usernames: ${availableCount}`;
      await new Promise(r=>setTimeout(r,100)); // small delay between batches
    }
  }

  // Check remaining batch
  if(batch.length>0 && !stopFlag){
    const res = await checkBatch(workerURL,batch);
    for(let key in res){
      totalChecked++;
      if(res[key]){
        availableCount++;
        const div=document.createElement('div');
        div.textContent=key;
        div.className='username';
        div.onclick=()=>navigator.clipboard.writeText(key);
        resultsDiv.appendChild(div);
      }
    }
    const progress=Math.min((totalChecked/totalCombos)*100,100);
    progressBar.style.width=`${progress}%`;
    progressText.innerText=`Progress: ${progress.toFixed(1)}% | Checked: ${totalChecked}`;
    counter.innerText=`Available Usernames: ${availableCount}`;
  }

  if(!stopFlag) alert(`✅ Finished checking! ${availableCount} usernames available.`);
}
</script>

</body>
</html>
